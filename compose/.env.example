# Routing selector for Caddy template mounted by docker-compose.yml.
# - Caddyfile.local  = local/day-1 HTTP on localhost
# - Caddyfile.domain = real domain + automatic TLS via Caddy
# - Caddyfile.domain.assets = domain mode with separate asset host routing
CADDYFILE_TEMPLATE=Caddyfile.local

# Domain is used by Caddyfile.domain. Keep placeholder until DNS is ready.
DOMAIN=lms.example.org
ASSET_DOMAIN=assets.example.org
CADDY_CLASSHUB_MAX_BODY=650MB
CADDY_HELPER_MAX_BODY=1MB

POSTGRES_DB=classhub
POSTGRES_USER=classhub
POSTGRES_PASSWORD=REPLACE_ME_STRONG

MINIO_ROOT_USER=minio_admin
MINIO_ROOT_PASSWORD=REPLACE_ME_STRONG

DJANGO_DEBUG=0
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1
DJANGO_SECRET_KEY=REPLACE_ME_STRONG
DJANGO_TIME_ZONE=America/Chicago
DJANGO_ADMIN_2FA_REQUIRED=1
DJANGO_TEACHER_2FA_REQUIRED=1
CSRF_TRUSTED_ORIGINS=http://localhost
DJANGO_SESSION_COOKIE_DOMAIN=
DJANGO_CSRF_COOKIE_DOMAIN=
# Optional override. In production, if left blank, Class Hub applies a safe
# report-only baseline CSP automatically.
DJANGO_CSP_REPORT_ONLY_POLICY=
DJANGO_EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
DJANGO_EMAIL_HOST=
DJANGO_EMAIL_PORT=587
DJANGO_EMAIL_HOST_USER=
DJANGO_EMAIL_HOST_PASSWORD=
DJANGO_EMAIL_USE_TLS=1
DJANGO_EMAIL_USE_SSL=0
DJANGO_EMAIL_TIMEOUT_SECONDS=10
DJANGO_DEFAULT_FROM_EMAIL=classhub@localhost
TEACHER_INVITE_FROM_EMAIL=classhub@localhost
TEACHER_2FA_INVITE_MAX_AGE_SECONDS=259200
TEACHER_2FA_DEVICE_NAME=teacher-primary
DJANGO_SECURE_SSL_REDIRECT=0
DJANGO_SECURE_HSTS_SECONDS=3600
DJANGO_SECURE_HSTS_INCLUDE_SUBDOMAINS=0
DJANGO_SECURE_HSTS_PRELOAD=0
DJANGO_SECURE_REFERRER_POLICY=strict-origin-when-cross-origin
# Safe-by-default: do not trust forwarded headers unless you are behind a trusted proxy
# that overwrites X-Forwarded-* (for this stack, typically Caddy as first hop).
REQUEST_SAFETY_TRUST_PROXY_HEADERS=0
REQUEST_SAFETY_XFF_INDEX=0
CLASSHUB_UPLOAD_MAX_MB=600
CLASSHUB_UPLOAD_SCAN_ENABLED=0
CLASSHUB_UPLOAD_SCAN_COMMAND=clamscan --no-summary --stdout
CLASSHUB_UPLOAD_SCAN_TIMEOUT_SECONDS=20
CLASSHUB_UPLOAD_SCAN_FAIL_CLOSED=0
CLASSHUB_MARKDOWN_ALLOW_IMAGES=0
CLASSHUB_MARKDOWN_ALLOWED_IMAGE_HOSTS=
# Optional separate origin for lesson assets/videos rendered in lesson markdown.
# Leave blank to use same-origin links.
CLASSHUB_ASSET_BASE_URL=
CLASSHUB_JOIN_RATE_LIMIT_PER_MINUTE=20
CLASSHUB_DEVICE_REJOIN_COOKIE_NAME=classhub_student_hint
CLASSHUB_DEVICE_REJOIN_MAX_AGE_DAYS=30
CLASSHUB_SUBMISSION_RETENTION_DAYS=0
CLASSHUB_STUDENT_EVENT_RETENTION_DAYS=0
# Optional defaults for scripts/retention_maintenance.sh
RETENTION_SUBMISSION_DAYS=90
RETENTION_EVENT_DAYS=180
RETENTION_EVENT_EXPORT_DIR=/uploads/retention_exports
RETENTION_SCAVENGE_MODE=report
RETENTION_ALERT_WEBHOOK_URL=
RETENTION_ALERT_ON_SUCCESS=0
RUN_MIGRATIONS_ON_START=1

# Homework Helper backend
# Options: "ollama" (default), "openai", or "mock" (CI/test only)
HELPER_LLM_BACKEND=ollama
HELPER_MOCK_RESPONSE_TEXT=
HELPER_STRICTNESS=light
HELPER_SCOPE_MODE=strict
HELPER_REFERENCE_DIR=/app/tutor/reference
HELPER_REFERENCE_MAP={"piper_scratch":"piper_scratch.md"}
HELPER_REFERENCE_FILE=/app/tutor/reference/piper_scratch.md
HELPER_SCOPE_TOKEN_MAX_AGE_SECONDS=7200
HELPER_RESPONSE_MAX_CHARS=2200
HELPER_MAX_CONCURRENCY=2
HELPER_QUEUE_MAX_WAIT_SECONDS=10
HELPER_QUEUE_POLL_SECONDS=0.2
HELPER_QUEUE_SLOT_TTL_SECONDS=120
HELPER_BACKEND_MAX_ATTEMPTS=2
HELPER_BACKOFF_SECONDS=0.4
HELPER_CIRCUIT_BREAKER_FAILURES=5
HELPER_CIRCUIT_BREAKER_TTL_SECONDS=30
HELPER_RATE_LIMIT_PER_MINUTE=30
HELPER_RATE_LIMIT_PER_IP_PER_MINUTE=90
HELPER_REQUIRE_CLASSHUB_TABLE=0
HELPER_REQUIRE_SCOPE_TOKEN_FOR_STAFF=0
HELPER_TOPIC_FILTER_MODE=strict
HELPER_TEXT_LANGUAGE_KEYWORDS=pascal,python,java,javascript,typescript,c++,c#,csharp,ruby,php,go,golang,rust,swift,kotlin

# Ollama (local model server)
OLLAMA_BASE_URL=http://ollama:11434
OLLAMA_MODEL=llama3.2:1b
OLLAMA_TIMEOUT_SECONDS=30
OLLAMA_TEMPERATURE=0.2
OLLAMA_TOP_P=0.9
OLLAMA_NUM_PREDICT=400

# OpenAI (optional fallback)
OPENAI_API_KEY=__SET_ME__
OPENAI_MODEL=gpt-5.2
OPENAI_MAX_OUTPUT_TOKENS=400

# Deploy smoke checks (used by scripts/smoke_check.sh --strict)
SMOKE_BASE_URL=https://lms.example.org
SMOKE_CLASS_CODE=ABCD1234
SMOKE_DISPLAY_NAME=Smoke Student
SMOKE_HELPER_MESSAGE=Give one short Scratch hint about moving a sprite.
SMOKE_TEACHER_USERNAME=teacher1
SMOKE_TEACHER_PASSWORD=CHANGE_ME
# Optional: pre-issued Django session key for /teach checks (used by golden smoke).
SMOKE_TEACHER_SESSION_KEY=
SMOKE_TIMEOUT_SECONDS=20
SMOKE_INSECURE_TLS=0
